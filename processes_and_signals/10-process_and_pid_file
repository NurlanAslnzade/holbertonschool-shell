#!/usr/bin/env bash
# This script creates a PID file, runs indefinitely, and implements custom signal handlers 
# for SIGTERM, SIGINT, and SIGQUIT, including safe cleanup and termination.

# DİQQƏT: Test mühitində sudo istifadə edilmədiyi üçün, icazə problemini həll etmək 
# məqsədilə PID faylının yolunu (/var/run-dan) /tmp-yə dəyişirik.
PID_FILE="/tmp/myscript.pid"

# --- 1. Cleanup and Exit Function (For SIGTERM and SIGQUIT) ---
cleanup_and_exit() {
    if [ -f "$PID_FILE" ]; then
        rm -f "$PID_FILE"
    fi
    exit 0
}

# --- 2. Signal Traps ---
trap 'echo "I hate the kill command"; cleanup_and_exit' SIGTERM
trap 'cleanup_and_exit' SIGQUIT
trap 'echo "Y U no love me?!";' SIGINT

# --- 3. Write PID File ---
echo $$ > "$PID_FILE"

# --- 4. Main Infinite Loop ---
while true; do
    echo "To infinity and beyond"
    sleep 2
done

cleanup_and_exit
