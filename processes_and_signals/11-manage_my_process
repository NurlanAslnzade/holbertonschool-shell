#!/usr/bin/env bash
# This is an init-style script to manage the 'manage_my_process' daemon.

# Variables
DAEMON_SCRIPT="./manage_my_process"
PID_FILE="/var/run/my_process.pid"
NAME="manage_my_process"

# --- Functions ---

# Function to start the daemon
# $1: Set to 'silent' (or similar) to suppress "started" message.
start_daemon() {
    "$DAEMON_SCRIPT" &
    
    # The PID of the last background job is captured in $!
    echo $! > "$PID_FILE"
    
    # Only echo if it's not run silently (i.e., not from restart)
    if [ "$1" != "silent" ]; then
        echo "$NAME started"
    fi
}

# Function to stop the daemon
# $1: Set to 'silent' (or similar) to suppress "stopped" message.
stop_daemon() {
    
    # Check if PID file exists
    if [ -f "$PID_FILE" ]; then
        # Read the PID
        PID=$(cat "$PID_FILE")
        
        # Send SIGTERM (default signal) to the process
        kill "$PID" 2>/dev/null
        
        # Delete the PID file
        rm -f "$PID_FILE"
    fi
    
    # Only echo if it's not run silently (i.e., not from restart)
    if [ "$1" != "silent" ]; then
        echo "$NAME stopped"
    fi
}

# --- Main Logic (Case Statement) ---

case "$1" in
    start)
        # Normal start: echo output
        start_daemon
        ;;
    stop)
        # Normal stop: echo output
        stop_daemon
        ;;
    restart)
        # Restart: Stop silently, Start silently, then print 'restarted'
        stop_daemon silent
        start_daemon silent
        
        # The final required output for the 'restart' command
        echo "$NAME restarted"
        ;;
    *)
        # Default usage message for any other or missing argument
        echo "Usage: $NAME {start|stop|restart}"
        exit 1
        ;;
esac

exit 0
