#!/usr/bin/env bash
# This is an init-style script to manage the 'manage_my_process' daemon.

# Variables
DAEMON_SCRIPT="./manage_my_process"
PID_FILE="/var/run/my_process.pid"
NAME="manage_my_process"

# --- Functions ---

# Function to start the daemon
start_daemon() {
    "$DAEMON_SCRIPT" &
    
    # The PID of the last background job is captured in $!
    echo $! > "$PID_FILE"
    
    echo "$NAME started"
}

# Function to stop the daemon
stop_daemon() {
    SHOULD_ECHO_STOPPED=1 # Çıxışın çap olunacağını fərz edirik
    
    # Check if PID file exists
    if [ -f "$PID_FILE" ]; then
        # Read the PID
        PID=$(cat "$PID_FILE")
        
        # Send SIGTERM (default signal) to the process
        # We only try to kill if the PID file exists
        kill "$PID" 2>/dev/null
        
        # Delete the PID file
        rm -f "$PID_FILE"
    fi
    
    # İndi çıxışı şərtlərdən asılı olmayaraq çap edirik (testin tələbi budur)
    if [ "$SHOULD_ECHO_STOPPED" -eq 1 ]; then
        echo "$NAME stopped"
    fi
}

# --- Main Logic (Case Statement) ---

case "$1" in
    start)
        start_daemon
        ;;
    stop)
        stop_daemon
        ;;
    restart)
        # Restart is stop followed by start
        # The 'stop' inside restart should still print the 'stopped' message
        stop_daemon
        # We need to explicitly check if stop_daemon successfully stopped a process
        # For simplicity, we just proceed with start as per the task note.
        start_daemon
        # The prompt output shows "restarted" after stop and start messages:
        echo "$NAME restarted"
        ;;
    *)
        # Default usage message for any other or missing argument
        echo "Usage: $NAME {start|stop|restart}"
        exit 1
        ;;
esac

exit 0
